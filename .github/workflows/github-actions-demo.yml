name: Run ReadyAPI Tests

on:
  workflow_dispatch:

jobs:
  run-tests:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout Code
        uses: actions/checkout@v3

      - name: 🧪 Run ReadyAPI tests via Docker
        env:
          SLM_API_KEY: ${{ secrets.SLM_API_KEY }}
          SLM_LICENSE_SERVER: ${{ secrets.SLM_LICENSE_SERVER }}
        run: |
          echo "📂 Listing files in workspace:"
          ls -la "${{ github.workspace }}"

          echo "🐳 Pulling ReadyAPI Docker image..."
          docker pull smartbear/ready-api-soapui-testrunner

          echo "🚀 Running ReadyAPI tests..."
          docker run --rm \
          -v "${{ github.workspace }}":/project \
          -e SLM_LICENSE_SERVER="${{ secrets.SLM_LICENSE_SERVER }}" \
          -e SLM_API_KEY="${{ secrets.SLM_API_KEY }}" \
          smartbear/ready-api-soapui-testrunner \
          -EDefault environment \
          -sDemoAppTestSuite \
          -cPositiveScenario \
          -r -f/project/reports \
          /project/DemoAppProject.xml
        
      - name: 📤 Upload Test Results
        uses: actions/upload-artifact@v4
        with:
          name: readyapi-results
          path: ./reports
